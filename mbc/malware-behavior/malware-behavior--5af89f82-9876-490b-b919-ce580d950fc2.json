{
    "type": "bundle",
    "id": "bundle--5b6029f2-8466-43e5-ad34-0c5298eaed10",
    "objects": [
        {
            "type": "malware-behavior",
            "spec_version": "2.1",
            "id": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
            "created_by_ref": "identity--b73c59c1-8560-449a-b8d0-c2ce0533c5bf",
            "created": "2019-08-01T00:00:00.000Z",
            "modified": "2024-02-06T00:00:00.000Z",
            "name": "Debugger Detection",
            "obj_defn": {
                "description": "Malware detects whether it's being executed inside a debugger by checking for artifacts such as DLLs, processes, and registry keys [1]. If malware detects a debugger,  it may change its execution path or change its code to initiate a crash [2].\n\nWhile many methods are listed in the table below, among the most commonly used are:\n- Using APIs such as IsDebuggerPresent, CheckRemoteDebuggerPresent, and OutputDebugString\n- Reading the BeingDebugged bit (is it a 1 or 0) in the Process Environment Block (PEB)\n- Checking whether a software breakpoint instruction is used (INT3; 0xCC opcode)\n\nDetails on detecting debuggers can be found in the references.",
                "external_id": "B0001",
                "source_name": "mitre-mbc",
                "url": "https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis/debugger-detection.md"
            },
            "tags": {
                "Anti-Analysis-Type": "Detection"
            },
            "objective_refs": [
                "malware-objective--475598d1-fbe7-4924-816b-d7cf358a6acb"
            ],
            "detection_rules": [
                {
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "check for trap flag exception",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-trap-flag-exception.yml"
                },
                {
                    "detect_ref": "malware-method--a6b1bd32-1578-464c-aa36-8828ddc322da",
                    "rule_name": "check for software breakpoints",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-software-breakpoints.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.QueryInformationJobObject",
                        "kernel32.OpenProcess"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_type": "capa",
                    "rule_name": "check process job object",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-process-job-object.yml"
                },
                {
                    "detect_ref": "malware-method--26a39404-f65a-47de-a17d-c7f165cdb79b",
                    "rule_name": "check for PEB BeingDebugged flag",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-peb-beingdebugged-flag.yml"
                },
                {
                    "detect_ref": "malware-method--f1794c8b-70b8-45b5-9533-dbf410377d5d",
                    "rule_name": "check for time delay via GetTickCount",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-gettickcount.yml"
                },
                {
                    "api_fncs": [
                        "SetHandleInformation",
                        "CloseHandle"
                    ],
                    "detect_ref": "malware-method--544c61a0-3fe6-4180-90b0-170b45f49781",
                    "rule_type": "capa",
                    "rule_name": "check for protected handle exception",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-protected-handle-exception.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.SetLastError",
                        "kernel32.GetLastError",
                        "kernel32.OutputDebugString"
                    ],
                    "detect_ref": "malware-method--9eeadfa6-8ad4-44e8-a508-42c21a94b96e",
                    "rule_type": "capa",
                    "rule_name": "check for OutputDebugString error",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-outputdebugstring-error.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.GetWriteWatch"
                    ],
                    "detect_ref": "malware-method--8e39495e-0021-4ef0-b71f-0d0c6bf92760",
                    "rule_type": "capa",
                    "rule_name": "check for unexpected memory writes",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-unexpected-memory-writes.yml"
                },
                {
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "check for kernel debugger via shared user data structure",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-kernel-debugger-via-shared-user-data-structure.yml"
                },
                {
                    "detect_ref": "malware-method--3230a370-086c-47ab-b804-83c362923f4f",
                    "rule_name": "check for time delay via QueryPerformanceCounter",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-queryperformancecounter.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.GetThreadContext"
                    ],
                    "detect_ref": "malware-method--88312528-3460-4c8e-9b2e-ad76e2fb3f5b",
                    "rule_type": "capa",
                    "rule_name": "check for hardware breakpoints",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-hardware-breakpoints.yml"
                },
                {
                    "api_fncs": [
                        "NtQueryInformationProcess"
                    ],
                    "detect_ref": "malware-method--4716ea7f-733a-411c-add1-9889b7b9d4ef",
                    "rule_type": "capa",
                    "rule_name": "check ProcessDebugPort",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-processdebugport.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.CheckRemoteDebuggerPresent",
                        "WUDFPlatform.WudfIsAnyDebuggerPresent",
                        "WUDFPlatform.WudfIsKernelDebuggerPresent",
                        "WUDFPlatform.WudfIsUserDebuggerPresent"
                    ],
                    "detect_ref": "malware-method--a38ae614-cb11-4113-ba1e-e15ae36c8773",
                    "rule_type": "capa",
                    "rule_name": "check for debugger via API",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-debugger-via-api.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.CheckRemoteDebuggerPresent",
                        "WUDFPlatform.WudfIsAnyDebuggerPresent",
                        "WUDFPlatform.WudfIsKernelDebuggerPresent",
                        "WUDFPlatform.WudfIsUserDebuggerPresent"
                    ],
                    "detect_ref": "malware-method--0950ee9d-a725-4513-ba3d-ba5b4c698e75",
                    "rule_type": "capa",
                    "rule_name": "check for debugger via API",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-debugger-via-api.yml"
                },
                {
                    "detect_ref": "malware-method--df410701-9456-444e-984b-ccf277f39171",
                    "rule_name": "check for PEB NtGlobalFlag flag",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-peb-ntglobalflag-flag.yml"
                },
                {
                    "detect_ref": "malware-method--51930431-c070-4499-883d-a75ba3abed91",
                    "rule_name": "execute anti-debugging instructions",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/execute-anti-debugging-instructions.yml"
                },
                {
                    "detect_ref": "malware-method--517a4671-0c4e-4d32-b3ad-d462009897e5",
                    "rule_name": "PEB access",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/lib/peb-access.yml"
                },
                {
                    "api_fncs": [
                        "CheckRemoteDebuggerPresent",
                        "NtQueryInformationProcess"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_checkremotedebuggerpresent",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_checkremotedebuggerpresent.py"
                },
                {
                    "api_fncs": [
                        "LdrGetDllHandle",
                        "LdrLoadDll"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antiav_nthookengine_libs",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antiav_nthookengine_libs.py"
                },
                {
                    "api_fncs": [
                        "LdrGetDllHandle",
                        "LdrLoadDll"
                    ],
                    "detect_ref": "malware-method--e7f252b8-a384-4c46-9c88-41af414c7bc7",
                    "rule_name": "antiav_nthookengine_libs",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antiav_nthookengine_libs.py"
                },
                {
                    "api_fncs": [
                        "SetUnhandledExceptionFilter"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_setunhandledexceptionfilter",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_setunhandledexceptionfilter.py"
                },
                {
                    "api_fncs": [
                        "SetUnhandledExceptionFilter"
                    ],
                    "detect_ref": "malware-method--7a46b5c9-8837-4ee8-896b-9b88b280f486",
                    "rule_name": "antidebug_setunhandledexceptionfilter",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_setunhandledexceptionfilter.py"
                },
                {
                    "api_fncs": [
                        "AddVectoredExceptionHandler"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_addvectoredexceptionhandler",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_addvectoredexceptionhandler.py"
                },
                {
                    "api_fncs": [
                        "GetLastError",
                        "SetLastError",
                        "OutputDebugStringW",
                        "OutputDebugStringA"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_outputdebugstring",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_outputdebugstring.py"
                },
                {
                    "api_fncs": [
                        "GetLastError",
                        "SetLastError",
                        "OutputDebugStringW",
                        "OutputDebugStringA"
                    ],
                    "detect_ref": "malware-method--9eeadfa6-8ad4-44e8-a508-42c21a94b96e",
                    "rule_name": "antidebug_outputdebugstring",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_outputdebugstring.py"
                },
                {
                    "api_fncs": [
                        "GetTickCount"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_gettickcount",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_gettickcount.py"
                },
                {
                    "api_fncs": [
                        "GetTickCount"
                    ],
                    "detect_ref": "malware-method--f1794c8b-70b8-45b5-9533-dbf410377d5d",
                    "rule_name": "antidebug_gettickcount",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_gettickcount.py"
                },
                {
                    "api_fncs": [
                        "VirtualProtectEx",
                        "NtAllocateVirtualMemory",
                        "NtProtectVirtualMemory"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_guardpages",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_guardpages.py"
                },
                {
                    "api_fncs": [
                        "VirtualProtectEx",
                        "NtAllocateVirtualMemory",
                        "NtProtectVirtualMemory"
                    ],
                    "detect_ref": "malware-method--619673a0-ceb7-450e-9db3-90957d636845",
                    "rule_name": "antidebug_guardpages",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_guardpages.py"
                },
                {
                    "api_fncs": [
                        "NtSetInformationThread"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_ntsetinformationthread",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_ntsetinformationthread.py"
                },
                {
                    "api_fncs": [
                        "NtSetInformationThread"
                    ],
                    "detect_ref": "malware-method--d97a9758-4705-4d21-b736-8f6643bfa5b5",
                    "rule_name": "antidebug_ntsetinformationthread",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_ntsetinformationthread.py"
                },
                {
                    "api_fncs": [
                        "DebugActiveProcess"
                    ],
                    "detect_ref": "malware-behavior--5af89f82-9876-490b-b919-ce580d950fc2",
                    "rule_name": "antidebug_debugactiveprocess",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/antidebug_debugactiveprocess.py"
                }
            ],
            "obj_version": "2.2",
            "external_references": [
                {
                    "source_name": "checkpoint",
                    "description": "Check Point Research, \"CP<r>: Evasion Techniques,\" evasions.checkpoint.com, [Online].",
                    "url": "https://evasions.checkpoint.com"
                },
                {
                    "source_name": "sikorski-book",
                    "description": "M. Sikorski and A. Honig, Practical Malware Analysis: The Hands-On Guide to Dissecting Malicious Software, No Starch Press, 2012."
                },
                {
                    "source_name": "ferrie",
                    "description": "P. Ferrie, \"The Ultimate Anti-Debugging Reference,\" May 4, 2011 [Online].",
                    "url": "https://anti-reversing.com/Downloads/Anti-Reversing/The_Ultimate_Anti-Reversing_Reference.pdf"
                },
                {
                    "source_name": "fireeye-vmaware",
                    "description": "\"The Dead Giveaways of VM-Aware Malware,\" FireEye, Jan 2011.",
                    "url": "https://web.archive.org/web/20160927120026/https://web.archive.org/web/20200815134441/https://www.fireeye.com/blog/threat-research/2011/01/the-dead-giveaways-of-vm-aware-malware.html"
                },
                {
                    "source_name": "lordnoteworthy",
                    "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
                    "url": "https://github.com/LordNoteworthy/al-khaser"
                },
                {
                    "source_name": "falliere-antidebug",
                    "description": "N. Falliere, \"Windows Anti-Debug Reference,\" Symantec, Sep 11, 2007.",
                    "url": "https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=230d68b2-c80f-4436-9c09-ff84d049da33&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments"
                },
                {
                    "source_name": "lordnoteworthy",
                    "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
                    "url": "https://github.com/LordNoteworthy/al-khaser"
                },
                {
                    "source_name": "mendrez",
                    "description": "R. Mendrez, \"Gamut Spambot Analysis,\" Trustwave, blog, Mar. 4, 2014 [Online].",
                    "url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/gamut-spambot-analysis/"
                },
                {
                    "source_name": "baker",
                    "description": "B. Baker and A. Chiu, \"Threat Spotlight: Rombertik - Gazing Past the Smoke, Mirrors, and Trapdoors,\" Cisco Threat Research, blog, May 4, 2013 [Online].",
                    "url": "https://blogs.cisco.com/security/talos/rombertik"
                },
                {
                    "source_name": "fireeye-poisonivy",
                    "description": "\"Poison Ivy: Assessing Damange and Extracting Intelligence,\" FireEye, Special Report, 2014 [Online].",
                    "url": "https://www.mandiant.com/sites/default/files/2021-09/rpt-poison-ivy.pdf"
                },
                {
                    "source_name": "dong-matanbuchus",
                    "description": "C. Dong, \"MATANBUCHUS: Another Loader as a Service Malware,\" Offset Training Solutions, blog, Feb. 15, 2022 [Online].",
                    "url": "https://www.0ffset.net/reverse-engineering/matanbuchus-loader-analysis/"
                },
                {
                    "source_name": "cohen-matabuchus",
                    "description": "B. Cohen, \"Inside Matanbuchus: A Quirky Loader,\" CyberArk, blog, Jul. 26, 2022 [Online].",
                    "url": "https://www.cyberark.com/resources/threat-research-blog/inside-matanbuchus-a-quirky-loader"
                },
                {
                    "source_name": "zhang-poisonivy",
                    "description": "X. Zhang, \"Deep Analysis of New Poison Ivy Variant,\" Fortiguard Labs Threat Research, Aug. 23, 2017 [Online].",
                    "url": "https://www.fortinet.com/blog/threat-research/deep-analysis-of-new-poison-ivy-variant"
                },
                {
                    "source_name": "vaish-ursnif",
                    "description": "A. Vaish and S. Nemes, \"Newly Observed Ursnif Variant Employs Malicious TLS Callback Technique to Achieve Process Injection,\" FireEye, Nov. 28, 2017.",
                    "url": "https://web.archive.org/web/20171204024018/https://www.fireeye.com/blog/threat-research/2017/11/ursnif-variant-malicious-tls-callback-technique.html"
                },
                {
                    "source_name": "capa analysis",
                    "description": "Analysis output, capa 4.0, analyzed at MITRE on Oct. 12, 2022.",
                    "url": "https://github.com/mandiant/capa-rules"
                }
            ],
            "object_marking_refs": [
                "marking-definition--093b6375-cd45-4aa3-8f91-6a03ddd7a3d3"
            ],
            "extensions": {
                "extension-definition--d57b7c9c-7fa6-436b-b82c-8e6f69cdc3d0": {
                    "extension_type": "new-sdo"
                }
            }
        }
    ]
}