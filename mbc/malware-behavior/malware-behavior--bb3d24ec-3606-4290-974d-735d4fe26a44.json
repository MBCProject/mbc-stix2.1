{
    "type": "bundle",
    "id": "bundle--4eb62b56-2714-49b0-ae42-8b89e74f8009",
    "objects": [
        {
            "type": "malware-behavior",
            "spec_version": "2.1",
            "id": "malware-behavior--bb3d24ec-3606-4290-974d-735d4fe26a44",
            "created_by_ref": "identity--b73c59c1-8560-449a-b8d0-c2ce0533c5bf",
            "created": "2021-11-08T00:00:00.000Z",
            "modified": "2024-04-28T00:00:00.000Z",
            "name": "Hijack Execution Flow",
            "obj_defn": {
                "source_name": "mitre-mbc",
                "description": "Malware may execute by hijacking the way operating systems run programs. Malware (e.g. rootkit) alters API behavior or redirects execution (i.e., hooking) to a malicious API version for a variety of purposes. Malware may use hooking to load and execute code within the context of another process, hiding execution and gaining elevated privileges and access to the process's memory. Different types of hooking are defined as methods below.\n\nNote that in MBC, Hooking is also associated with the [Defense Evasion](https://github.com/MBCProject/mbc-markdown/blob/main/defense-evasion), [Persistence](https://github.com/MBCProject/mbc-markdown/blob/main/persistence), [Privilege Escalation](https://github.com/MBCProject/mbc-markdown/blob/main/privilege-escalation), and [Anti-Behavioral Analysis](https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis) objectives.\n\nFor discussion related to the Credential Access and Collection objectives, see **Input Capture: Credential API Hooking ([T1056.004](https://attack.mitre.org/techniques/T1056/004/))**.\n\nFor hooking related to memory dump evasion, see **Memory Dump Evasion ([B0006](https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis/memory-dump-evasion.md))**.\n\nSee ATT&CK: **Hijack Execution Flow ([T1574](https://attack.mitre.org/techniques/T1574), [T1625](https://attack.mitre.org/techniques/T1625))**.",
                "url": "https://github.com/MBCProject/mbc-markdown/blob/main/defense-evasion/hijack-execution-flow.md",
                "external_id": "F0015"
            },
            "tags": {
                "Anti-Analysis-Type": "Evasion"
            },
            "objective_refs": [
                "malware-objective--f38b4e5f-7c1b-4c17-9610-a739550ab918",
                "malware-objective--790ece72-0fda-4427-87cf-2ef3a7187bce",
                "malware-objective--31fedb68-9931-40b1-ac24-061b50a0a4ec",
                "malware-objective--debfe6b5-b30d-429f-aa74-b416af866f7b",
                "malware-objective--b0d7b24c-db02-461a-a9c9-bcf790572114",
                "malware-objective--84875b35-71e1-445d-bd40-0fb23e5b9e1c"
            ],
            "detection_rules": [
                {
                    "rule_type": "capa",
                    "rule_name": "create new application domain in .NET",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/host-interaction/memory/create-new-application-domain-in-dotnet.yml"
                },
                {
                    "rule_type": "capa",
                    "rule_name": "execute shellcode via Windows callback function",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/load-code/shellcode/execute-shellcode-via-windows-callback-function.yml",
                    "api_fncs": [
                        "CallWindowProc",
                        "EnumCalendarInfo",
                        "EnumCalendarInfoEx",
                        "EnumDateFormats",
                        "GrayString",
                        "LineDDA",
                        "EnumChildWindows",
                        "EnumDesktops",
                        "EnumDesktopWindows",
                        "EnumFontFamilies",
                        "EnumFontFamiliesEx",
                        "EnumFonts",
                        "EnumProps",
                        "EnumPropsEx",
                        "EnumResourceTypes",
                        "EnumSystemCodePages",
                        "EnumSystemGeoID",
                        "EnumSystemLanguageGroups",
                        "EnumSystemLocales",
                        "EnumThreadWindows",
                        "EnumUILanguages",
                        "EnumWindows",
                        "EnumChildWindows",
                        "EnumTimeFormats"
                    ],
                    "detect_ref": "malware-method--e5320e36-fe1d-4ec0-adcf-59768ff7c694"
                },
                {
                    "rule_type": "capa",
                    "rule_name": "rebuild import table",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/load-code/pe/rebuild-import-table.yml",
                    "api_fncs": [
                        "LoadLibraryA",
                        "GetProcAddress"
                    ],
                    "detect_ref": "malware-method--33e32618-145f-4113-9ffc-aed16ee5c2dd"
                },
                {
                    "rule_type": "cape",
                    "rule_name": "infostealer_keylog",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/infostealer_keylog.py",
                    "api_fncs": [
                        "SetWindowsHookExA",
                        "GetAsyncKeyState",
                        "SetWindowsHookExW"
                    ]
                },
                {
                    "rule_type": "cape",
                    "rule_name": "infostealer_keylog",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/infostealer_keylog.py",
                    "api_fncs": [
                        "SetWindowsHookExA",
                        "GetAsyncKeyState",
                        "SetWindowsHookExW"
                    ],
                    "detect_ref": "malware-method--f2058ea2-8c20-46c2-af01-8ff3b1dcf0c5"
                },
                {
                    "rule_type": "cape",
                    "rule_name": "antisandbox_mouse_hook",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_mouse_hook.py",
                    "api_fncs": [
                        "SetWindowsHookExA",
                        "SetWindowsHookExW"
                    ]
                },
                {
                    "rule_type": "cape",
                    "rule_name": "antisandbox_mouse_hook",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_mouse_hook.py",
                    "api_fncs": [
                        "SetWindowsHookExA",
                        "SetWindowsHookExW"
                    ],
                    "detect_ref": "malware-method--f2058ea2-8c20-46c2-af01-8ff3b1dcf0c5"
                },
                {
                    "rule_type": "cape",
                    "rule_name": "dll_load_uncommon_file_types",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/dll_load_uncommon.py",
                    "api_fncs": [
                        "LdrLoadDll"
                    ]
                },
                {
                    "rule_type": "cape",
                    "rule_name": "malicious_dynamic_function_loading",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/malicious_dynamic_function_loading.py",
                    "api_fncs": [
                        "LdrGetProcedureAddress",
                        "LdrLoadDll"
                    ]
                }
            ],
            "obj_version": "2.2",
            "related_object_refs": [
                "attack-pattern--aedfca76-3b30-4866-b2aa-0f1d7fd1e4b6",
                "attack-pattern--670a4d75-103b-4b14-8a9e-4652fa795edd"
            ],
            "external_references": [
                {
                    "source_name": "sans-score",
                    "description": "\"SCORE Security Checklist,\" SANS Institute [Online].",
                    "url": "https://www.sans.org/media/score/checklists/rootkits-investigation-procedures.pdf"
                },
                {
                    "source_name": "monnappa",
                    "description": "K.A. Monnappa, \"Inline Hooking (Inline Patching)\" in Learning Malware Analysis, Birmingham, UK: Packt Publishing, 2018, pp. 320-322.",
                    "url": "https://learning.oreilly.com/library/view/learning-malware-analysis/9781788392501/a0a506d6-d062-48c1-a0a8-57d6acb77785.xhtml"
                },
                {
                    "source_name": "bencsath",
                    "description": "B. Bencsath, G. Pek, L. Buttyan, and M. Felegyhazi, \"The Cousins of Stuxnet: Duqu, Flame, and Gauss,\" Future Internet, vol. 4, issue 4, Nov. 6, 2012 [Online].",
                    "url": "https://www.mdpi.com/1999-5903/4/4/971/html"
                },
                {
                    "source_name": "white-windowsfncs",
                    "description": "J. White, \"Abusing native Windows functions for shellcode execution,\" Jan. 17, 2017 [Online].",
                    "url": "http://ropgadget.com/posts/abusing_win_functions.html"
                },
                {
                    "source_name": "citizen lab",
                    "description": "M. Brooks, J. Dalek, and M. Crete-Nishihata, \"Between Hong Kong and Burma: Tracking UP007 and SLServer Espionage Campaigns,\" The Citizen Lab, Apr. 18, 2016 [Online].",
                    "url": "https://docs.microsoft.com/en-us/windows/win32/winmsg/about-hooks?redirectedfrom=MSDN#hook-procedures"
                },
                {
                    "source_name": "malwarebytes-kronos",
                    "description": "\"Inside the Kronos malware - part 1,\" Malwarebytes Labs, blog, Aug. 18, 2017 [Online].",
                    "url": "https://blog.malwarebytes.com/cybercrime/2017/08/inside-kronos-malware/"
                },
                {
                    "source_name": "trendmicro-ursnif",
                    "description": "\"PE_URSNIF.A2,\" Trend Micro, analysis report, Dec. 11, 2014 [Online].",
                    "url": "https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/PE_URSNIF.A2"
                },
                {
                    "source_name": "rascagneres-gravityrat",
                    "description": "P. Rascagneres, \"GravityRAT - The Two-Year Evolution Of An APT Targeting India,\" Talos, blog, Apr. 26, 2018 [Online].",
                    "url": "https://blog.talosintelligence.com/2018/04/gravityrat-two-year-evolution-of-apt.html"
                },
                {
                    "source_name": "hau",
                    "description": "B. Hau, T. Lee, and J. Homan, \"SYNful Knock - A Cisco router implant - Part I,\" Mandiant.com, 15 Sept. 2015 [Online].",
                    "url": "https://www.mandiant.com/resources/synful-knock-acis"
                },
                {
                    "source_name": "mundo-shamoon",
                    "description": "A. Mundo, \"Shamoon Returns to Wipe Systems in Middle East, Europe,\" McAfee, blog, Dec. 14, 2018 [Online].",
                    "url": "https://www.mcafee.com/blogs/other-blogs/mcafee-labs/shamoon-returns-to-wipe-systems-in-middle-east-europe/"
                },
                {
                    "source_name": "falliere-stuxnet",
                    "description": "N. Falliere, L. Murchu, and E. Chien, \"W32.Stuxnet Dossier,\" Symantec Security Response, Feb. 2011 [Online].",
                    "url": "https://docs.broadcom.com/doc/security-response-w32-stuxnet-dossier-11-en"
                }
            ],
            "object_marking_refs": [
                "marking-definition--093b6375-cd45-4aa3-8f91-6a03ddd7a3d3"
            ],
            "extensions": {
                "extension-definition--d57b7c9c-7fa6-436b-b82c-8e6f69cdc3d0": {
                    "extension_type": "new-sdo"
                }
            }
        }
    ]
}