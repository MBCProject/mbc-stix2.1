{
    "type": "bundle",
    "id": "bundle--628df236-25b6-4652-8b76-d36650442acc",
    "objects": [
        {
            "type": "malware-behavior",
            "spec_version": "2.1",
            "id": "malware-behavior--f69ed861-f8ce-4ada-abfc-b5b82cc2cdda",
            "created_by_ref": "identity--b73c59c1-8560-449a-b8d0-c2ce0533c5bf",
            "created": "2019-08-01T00:00:00.000Z",
            "modified": "2024-04-27T00:00:00.000Z",
            "name": "Debugger Detection",
            "obj_defn": {
                "description": "Malware detects whether it's being executed inside a debugger by checking for artifacts such as DLLs, processes, and registry keys [1]. If malware detects a debugger,  it may change its execution path or change its code to initiate a crash [2].\n\nWhile many methods are listed in the table below, among the most commonly used are:\n- Using APIs such as IsDebuggerPresent, CheckRemoteDebuggerPresent, and OutputDebugString\n- Reading the BeingDebugged bit (is it a 1 or 0) in the Process Environment Block (PEB)\n- Checking whether a software breakpoint instruction is used (INT3; 0xCC opcode)\n\nDetails on detecting debuggers can be found in the references.",
                "external_id": "B0001",
                "source_name": "mitre-mbc",
                "url": "https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis/debugger-detection.md"
            },
            "tags": {
                "Anti-Analysis-Type": "Detection"
            },
            "objective_refs": [
                "malware-objective--f38b4e5f-7c1b-4c17-9610-a739550ab918"
            ],
            "detection_rules": [
                {
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "check for trap flag exception",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-trap-flag-exception.yml"
                },
                {
                    "detect_ref": "malware-method--54916c9e-da98-417a-b2c1-af08d8149332",
                    "rule_name": "check for software breakpoints",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-software-breakpoints.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.QueryInformationJobObject",
                        "kernel32.OpenProcess"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_type": "capa",
                    "rule_name": "check process job object",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-process-job-object.yml"
                },
                {
                    "detect_ref": "malware-method--c2c848d5-dc91-48d1-8cbe-e73d0356347d",
                    "rule_name": "check for PEB BeingDebugged flag",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-peb-beingdebugged-flag.yml"
                },
                {
                    "detect_ref": "malware-method--df977ef5-2089-4d8e-aaaa-65581ce511b5",
                    "rule_name": "check for time delay via GetTickCount",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-gettickcount.yml"
                },
                {
                    "api_fncs": [
                        "SetHandleInformation",
                        "CloseHandle"
                    ],
                    "detect_ref": "malware-method--f250bb58-d851-412d-aff9-592e4381b77c",
                    "rule_type": "capa",
                    "rule_name": "check for protected handle exception",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-protected-handle-exception.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.SetLastError",
                        "kernel32.GetLastError",
                        "kernel32.OutputDebugString"
                    ],
                    "detect_ref": "malware-method--60d3cd04-b6d5-4d9d-b5c8-3ca09ac6265c",
                    "rule_type": "capa",
                    "rule_name": "check for OutputDebugString error",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-outputdebugstring-error.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.GetWriteWatch"
                    ],
                    "detect_ref": "malware-method--c26d529e-4995-4439-aec7-468ca8152d4f",
                    "rule_type": "capa",
                    "rule_name": "check for unexpected memory writes",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-unexpected-memory-writes.yml"
                },
                {
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "check for kernel debugger via shared user data structure",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-kernel-debugger-via-shared-user-data-structure.yml"
                },
                {
                    "detect_ref": "malware-method--c6ea0fe9-93dd-4a27-ae7d-19bc4649a579",
                    "rule_name": "check for time delay via QueryPerformanceCounter",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-time-delay-via-queryperformancecounter.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.GetThreadContext"
                    ],
                    "detect_ref": "malware-method--8199415e-e560-4424-b421-97bc67f6f1cb",
                    "rule_type": "capa",
                    "rule_name": "check for hardware breakpoints",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-hardware-breakpoints.yml"
                },
                {
                    "api_fncs": [
                        "NtQueryInformationProcess"
                    ],
                    "detect_ref": "malware-method--d79b98c6-d1a6-4d49-9cee-87ea0ba43ceb",
                    "rule_type": "capa",
                    "rule_name": "check ProcessDebugPort",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-processdebugport.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.CheckRemoteDebuggerPresent",
                        "WUDFPlatform.WudfIsAnyDebuggerPresent",
                        "WUDFPlatform.WudfIsKernelDebuggerPresent",
                        "WUDFPlatform.WudfIsUserDebuggerPresent"
                    ],
                    "detect_ref": "malware-method--a5dbb020-9f0a-49cc-939c-d8718219a85d",
                    "rule_type": "capa",
                    "rule_name": "check for debugger via API",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-debugger-via-api.yml"
                },
                {
                    "api_fncs": [
                        "kernel32.CheckRemoteDebuggerPresent",
                        "WUDFPlatform.WudfIsAnyDebuggerPresent",
                        "WUDFPlatform.WudfIsKernelDebuggerPresent",
                        "WUDFPlatform.WudfIsUserDebuggerPresent"
                    ],
                    "detect_ref": "malware-method--a9247112-a0bd-4dc5-9c4b-1057c88b3cd6",
                    "rule_type": "capa",
                    "rule_name": "check for debugger via API",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-debugger-via-api.yml"
                },
                {
                    "detect_ref": "malware-method--6b137e25-bf39-4a3a-93bc-6634abc93be7",
                    "rule_name": "check for PEB NtGlobalFlag flag",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/check-for-peb-ntglobalflag-flag.yml"
                },
                {
                    "detect_ref": "malware-method--30fecd8d-d47a-47e7-9b0d-435a946dd375",
                    "rule_name": "execute anti-debugging instructions",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-debugging/debugger-detection/execute-anti-debugging-instructions.yml"
                },
                {
                    "detect_ref": "malware-method--457f5d4b-105c-49f9-bb17-0b126641baf4",
                    "rule_name": "PEB access",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/lib/peb-access.yml"
                },
                {
                    "api_fncs": [
                        "CheckRemoteDebuggerPresent",
                        "NtQueryInformationProcess"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_checkremotedebuggerpresent",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_checkremotedebuggerpresent.py"
                },
                {
                    "api_fncs": [
                        "LdrGetDllHandle",
                        "LdrLoadDll"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antiav_nthookengine_libs",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_nthookengine_libs.py"
                },
                {
                    "api_fncs": [
                        "LdrGetDllHandle",
                        "LdrLoadDll"
                    ],
                    "detect_ref": "malware-method--a5f1b658-541d-45be-a39e-7b454ad52247",
                    "rule_name": "antiav_nthookengine_libs",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_nthookengine_libs.py"
                },
                {
                    "api_fncs": [
                        "SetUnhandledExceptionFilter"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_setunhandledexceptionfilter",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_setunhandledexceptionfilter.py"
                },
                {
                    "api_fncs": [
                        "SetUnhandledExceptionFilter"
                    ],
                    "detect_ref": "malware-method--2dbde267-17c9-4245-802e-03d7feb013ad",
                    "rule_name": "antidebug_setunhandledexceptionfilter",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_setunhandledexceptionfilter.py"
                },
                {
                    "api_fncs": [
                        "AddVectoredExceptionHandler"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_addvectoredexceptionhandler",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_addvectoredexceptionhandler.py"
                },
                {
                    "api_fncs": [
                        "GetLastError",
                        "SetLastError",
                        "OutputDebugStringW",
                        "OutputDebugStringA"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_outputdebugstring",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_outputdebugstring.py"
                },
                {
                    "api_fncs": [
                        "GetLastError",
                        "SetLastError",
                        "OutputDebugStringW",
                        "OutputDebugStringA"
                    ],
                    "detect_ref": "malware-method--60d3cd04-b6d5-4d9d-b5c8-3ca09ac6265c",
                    "rule_name": "antidebug_outputdebugstring",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_outputdebugstring.py"
                },
                {
                    "api_fncs": [
                        "GetTickCount"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_gettickcount",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_gettickcount.py"
                },
                {
                    "api_fncs": [
                        "GetTickCount"
                    ],
                    "detect_ref": "malware-method--df977ef5-2089-4d8e-aaaa-65581ce511b5",
                    "rule_name": "antidebug_gettickcount",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_gettickcount.py"
                },
                {
                    "api_fncs": [
                        "VirtualProtectEx",
                        "NtAllocateVirtualMemory",
                        "NtProtectVirtualMemory"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_guardpages",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_guardpages.py"
                },
                {
                    "api_fncs": [
                        "VirtualProtectEx",
                        "NtAllocateVirtualMemory",
                        "NtProtectVirtualMemory"
                    ],
                    "detect_ref": "malware-method--b935a45e-cc61-427f-93f3-98a37364c77f",
                    "rule_name": "antidebug_guardpages",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_guardpages.py"
                },
                {
                    "api_fncs": [
                        "NtSetInformationThread"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_ntsetinformationthread",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_ntsetinformationthread.py"
                },
                {
                    "api_fncs": [
                        "NtSetInformationThread"
                    ],
                    "detect_ref": "malware-method--f0d8443a-af69-4c17-94b9-9679100e22c4",
                    "rule_name": "antidebug_ntsetinformationthread",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_ntsetinformationthread.py"
                },
                {
                    "api_fncs": [
                        "DebugActiveProcess"
                    ],
                    "detect_ref": "malware-behavior--3fbfa7ef-14de-42f3-bf42-062b88291b8f",
                    "rule_name": "antidebug_debugactiveprocess",
                    "rule_type": "cape",
                    "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antidebug_debugactiveprocess.py"
                }
            ],
            "obj_version": "2.3",
            "external_references": [
                {
                    "source_name": "checkpoint",
                    "description": "Check Point Research, \"CP<r>: Evasion Techniques,\" evasions.checkpoint.com, [Online].",
                    "url": "https://evasions.checkpoint.com"
                },
                {
                    "source_name": "sikorski-book",
                    "description": "M. Sikorski and A. Honig, Practical Malware Analysis: The Hands-On Guide to Dissecting Malicious Software, No Starch Press, 2012."
                },
                {
                    "source_name": "ferrie",
                    "description": "P. Ferrie, \"The Ultimate Anti-Debugging Reference,\" May 4, 2011 [Online].",
                    "url": "https://anti-reversing.com/Downloads/Anti-Reversing/The_Ultimate_Anti-Reversing_Reference.pdf"
                },
                {
                    "source_name": "fireeye-vmaware",
                    "description": "\"The Dead Giveaways of VM-Aware Malware,\" FireEye, Jan 2011.",
                    "url": "https://web.archive.org/web/20160927120026/https://web.archive.org/web/20200815134441/https://www.fireeye.com/blog/threat-research/2011/01/the-dead-giveaways-of-vm-aware-malware.html"
                },
                {
                    "source_name": "lordnoteworthy",
                    "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
                    "url": "https://github.com/LordNoteworthy/al-khaser"
                },
                {
                    "source_name": "falliere-antidebug",
                    "description": "N. Falliere, \"Windows Anti-Debug Reference,\" Symantec, Sep 11, 2007.",
                    "url": "https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=230d68b2-c80f-4436-9c09-ff84d049da33&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments"
                },
                {
                    "source_name": "lordnoteworthy",
                    "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
                    "url": "https://github.com/LordNoteworthy/al-khaser"
                },
                {
                    "source_name": "mendrez",
                    "description": "R. Mendrez, \"Gamut Spambot Analysis,\" Trustwave, blog, Mar. 4, 2014 [Online].",
                    "url": "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/gamut-spambot-analysis/"
                },
                {
                    "source_name": "baker",
                    "description": "B. Baker and A. Chiu, \"Threat Spotlight: Rombertik - Gazing Past the Smoke, Mirrors, and Trapdoors,\" Cisco Threat Research, blog, May 4, 2013 [Online].",
                    "url": "https://blogs.cisco.com/security/talos/rombertik"
                },
                {
                    "source_name": "fireeye-poisonivy",
                    "description": "\"Poison Ivy: Assessing Damange and Extracting Intelligence,\" FireEye, Special Report, 2014 [Online].",
                    "url": "https://www.mandiant.com/sites/default/files/2021-09/rpt-poison-ivy.pdf"
                },
                {
                    "source_name": "dong-matanbuchus",
                    "description": "C. Dong, \"MATANBUCHUS: Another Loader as a Service Malware,\" Offset Training Solutions, blog, Feb. 15, 2022 [Online].",
                    "url": "https://www.0ffset.net/reverse-engineering/matanbuchus-loader-analysis/"
                },
                {
                    "source_name": "cohen-matabuchus",
                    "description": "B. Cohen, \"Inside Matanbuchus: A Quirky Loader,\" CyberArk, blog, Jul. 26, 2022 [Online].",
                    "url": "https://www.cyberark.com/resources/threat-research-blog/inside-matanbuchus-a-quirky-loader"
                },
                {
                    "source_name": "zhang-poisonivy",
                    "description": "X. Zhang, \"Deep Analysis of New Poison Ivy Variant,\" Fortiguard Labs Threat Research, Aug. 23, 2017 [Online].",
                    "url": "https://www.fortinet.com/blog/threat-research/deep-analysis-of-new-poison-ivy-variant"
                },
                {
                    "source_name": "vaish-ursnif",
                    "description": "A. Vaish and S. Nemes, \"Newly Observed Ursnif Variant Employs Malicious TLS Callback Technique to Achieve Process Injection,\" FireEye, Nov. 28, 2017.",
                    "url": "https://web.archive.org/web/20171204024018/https://www.fireeye.com/blog/threat-research/2017/11/ursnif-variant-malicious-tls-callback-technique.html"
                },
                {
                    "source_name": "capa analysis",
                    "description": "Analysis output, capa 4.0, analyzed at MITRE on Oct. 12, 2022.",
                    "url": "https://github.com/mandiant/capa-rules"
                }
            ],
            "object_marking_refs": [
                "marking-definition--093b6375-cd45-4aa3-8f91-6a03ddd7a3d3"
            ],
            "extensions": {
                "extension-definition--d57b7c9c-7fa6-436b-b82c-8e6f69cdc3d0": {
                    "extension_type": "new-sdo"
                }
            }
        }
    ]
}